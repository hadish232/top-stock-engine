name: Hourly NSE Engine Run
on:
  schedule:
    - cron: '0 * * * *'    # every hour at minute 0 (UTC). adjust as you like
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install system deps
        run: |
          python -m pip install --upgrade pip

      - name: Install Python packages
        run: |
          pip install -r requirements.txt

      - name: Run engine
        env:
          GCP_SA_KEY: ${{ secrets.GCP_SA_KEY }}
          GDRIVE_FOLDER_ID: ${{ secrets.GDRIVE_FOLDER_ID }}
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
        run: |
          python run_engine.py
          CSV=$(ls outputs | sort -r | head -n1)
          python upload_to_drive.py "outputs/$CSV" $GDRIVE_FOLDER_ID
          python notify.py "outputs/$CSV"
